# 産業でガチ利用されるRaspberry Piの話

## Speeker
  * @kazuph

## Raspberry Pi

* 最新版モデル 3B+
  * WiFi 5G + BLE 対応

## なぜ使うか？

* 高い品質
  * 世界ナンバーワンの製造数 1900万台
  * ソニーの工場で生産

* 安価
  * 4000円ぐらい
  * 他社製は５万円ぐらい？

* 汎用的な開発環境
  * Debianがデフォルトで使える
  * CPUがARMだが、主要なソフトウェアはARM対応済み

* 安定供給
  * Raspberry Piが万が一、なくなっても互換製品もある

## 利用シーン

### プロトタイプの作成
* AkerunをNFCカード対応したときに利用
* カードリーダーを買ってきて、１日以下でプロトタイプができた

## 組み込み製品(マイコンなど）のデバッグ
* PCの代わりとして、ラズパイを利用
* ラズパイからマイコンに自動でプログラムを書き込む（CI/CD）
* 何かあれば、スマートロックからログをラズパイで吸い出せる

## 工場出荷ツール
* 検査に利用/WebUI
* リテラシーの高くない人でも操作できる
* Raspberry Pi → Jlink → BLEマイコン
* Raspberry Pi → Arduino → 基盤部品

## IoT Gatewayでの採用
* 最初は品質を懸念してたが、社内でのラズパイの実績をみて、いけそうと感じた
* 安価
  * 3B+ ではBLEも使える

* 電源まわり
  * 雷サージ対応のACアダプターを利用
  * 拡張基盤で静電気対策

* ログ戦略
  * ラズパイは容量が少ないのでログをたくさん貯められない→すぐ削除
  * IOパフォーマンスは高くない
    * できるだけオンメモリ
    * 再起動するタイミングでDISK(SDカード)へ落とす
  * SSHしてログを取り出すとかはできない（お客さんのところにあるので）
    * S3にアップロードする

* セキュリティ
  * SDカードである以上、中身は抜かれる
  * 大事なもの(認証情報など）はSDカードには入れない
    * 大事な情報はnRF52 に入れる
    * チップからも抜こうと思えば情報は抜けるが、製品を物理破壊しないとできないのでコッソリやるとかはムリ
    * ソースコードは暗号化
  * IoT Gatewayでいろいろやらない
    * Gatewayに徹する
    * 万が一乗っ取られても、サーバ側でブロックできるように

## ラズパイ使えないケース

* 4000円ですら高いとき
* 電池駆動させたいとき

* BLEだけでいいならnRF52
– 32bit ARM Cortex-M4F 64MHz, 512kB flash/64kB RAM
– Bluetooth/NFC Tag 両方搭載
– AES HW encryption, Thread safe and run-time protected

* WiFiもほしい場合は ESP32？

* 電池駆動
  * WiFiは厳しい
  * 一部の機能だけ分離
    * ex) BLEだけの電池駆動デバイスをたくさん + 給電付きゲートウェイ
